---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import Header from '../../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';

const posts = (await getCollection('blog'))
    .filter(post => post.id.startsWith('en/'))
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Inter:wght@300;400;500&display=swap');
			
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				background-color: #ffffff;
				color: #000000;
				font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
				line-height: 1.6;
			}

			main {
				width: 100%;
				max-width: 900px;
				margin: 0 auto;
				padding: 8rem 2rem 4rem;
				min-height: 80vh;
			}

			/* Page Header */
			.page-header {
				text-align: center;
				margin-bottom: 6rem;
				padding-bottom: 3rem;
				border-bottom: 1px solid #e0e0e0;
			}

			.page-title {
				font-family: 'Playfair Display', Georgia, serif;
				font-size: clamp(3rem, 8vw, 5rem);
				font-weight: 400;
				letter-spacing: -0.02em;
				line-height: 1.1;
				margin-bottom: 1rem;
				color: #000000;
			}

			.page-description {
				font-size: 1.125rem;
				font-weight: 300;
				color: #666666;
				max-width: 600px;
				margin: 0 auto;
				line-height: 1.8;
			}

			/* Posts Grid */
			.posts-grid {
				display: grid;
				gap: 2.5rem;
				list-style-type: none;
				margin: 0;
				padding: 0;
			}

			.post-card {
				display: block;
				text-decoration: none;
				color: inherit;
				transition: all 0.3s ease;
				position: relative;
			}

			.post-card:hover {
				transform: translateY(-2px);
			}

			.post-image-container {
				position: relative;
				margin-bottom: 1rem;
				overflow: hidden;
				border: 1px solid #e0e0e0;
			}

			.post-image-container::after {
				content: '';
				position: absolute;
				bottom: 0;
				left: 0;
				width: 0;
				height: 2px;
				background: #000000;
				transition: width 0.3s ease;
			}

			.post-card:hover .post-image-container::after {
				width: 100%;
			}

			.post-image-container img {
				width: 100%;
				height: 240px;
				object-fit: cover;
				display: block;
				transition: transform 0.3s ease;
			}

			.post-card:hover .post-image-container img {
				transform: scale(1.02);
			}

			.post-content {
				padding: 0 0.25rem;
			}

			.post-date {
				text-transform: uppercase;
				letter-spacing: 0.1em;
				font-size: 0.7rem;
				color: #999999;
				margin-bottom: 0.5rem;
				display: block;
			}

			.post-title {
				font-family: 'Playfair Display', Georgia, serif;
				font-size: 1.35rem;
				font-weight: 400;
				line-height: 1.3;
				color: #000000;
				margin: 0;
				transition: color 0.3s ease;
			}

			.post-card:hover .post-title {
				color: #666666;
			}

			/* Featured Post (First Post) */
			.post-card.featured {
				padding-bottom: 2.5rem;
				margin-bottom: 1.5rem;
				border-bottom: 1px solid #e0e0e0;
			}

			.post-card.featured .post-image-container img {
				height: 360px;
			}

			.post-card.featured .post-title {
				font-size: 2rem;
				margin-bottom: 0.75rem;
			}

			.post-card.featured .post-excerpt {
				font-size: 0.95rem;
				font-weight: 300;
				color: #666666;
				line-height: 1.7;
				margin-top: 0.75rem;
			}

			/* Empty State */
			.empty-state {
				text-align: center;
				padding: 6rem 2rem;
				color: #999999;
			}

			.empty-state p {
				font-size: 1.125rem;
				font-weight: 300;
			}

			@media (max-width: 768px) {
				main {
					padding: 4rem 1.5rem 3rem;
				}

				.page-header {
					margin-bottom: 4rem;
					padding-bottom: 2rem;
				}

				.posts-grid {
					gap: 2rem;
				}

				.post-image-container img {
					height: 200px !important;
				}

				.post-card.featured .post-image-container img {
					height: 260px !important;
				}

				.post-card.featured .post-title {
					font-size: 1.65rem;
				}

				.post-title {
					font-size: 1.2rem;
				}
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<header class="page-header">
				<h1 class="page-title">Daily Logs</h1>
				<p class="page-description">
					Dispatches from the trenchesâ€”burnt sourdough, broken code, and everything in between.
				</p>
			</header>

			<section>
				{posts.length === 0 ? (
					<div class="empty-state">
						<p>No posts yet. Check back soon.</p>
					</div>
				) : (
					<ul class="posts-grid">
						{posts.map((post, index) => (
							<li>
								<a 
									href={`/blog/${post.id.replace('en/', '')}/`} 
									class={index === 0 ? 'post-card featured' : 'post-card'}
								>
									{post.data.heroImage && (
										<div class="post-image-container">
											<Image 
												width={900} 
												height={index === 0 ? 480 : 360} 
												src={post.data.heroImage} 
												alt={post.data.title}
											/>
										</div>
									)}
									<div class="post-content">
										<time class="post-date">
											<FormattedDate date={post.data.pubDate} />
										</time>
										<h2 class="post-title">{post.data.title}</h2>
										{index === 0 && post.data.description && (
											<p class="post-excerpt">{post.data.description}</p>
										)}
									</div>
								</a>
							</li>
						))}
					</ul>
				)}
			</section>
		</main>
		<Footer />
	</body>
</html>